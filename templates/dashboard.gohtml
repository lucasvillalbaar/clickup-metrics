<!DOCTYPE html>
<html>

<head>
    <title>Métricas Kanban</title>
    <link rel="stylesheet" type="text/css" href="/static/styles.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="container-md">
    <div class="pt-2 container">
        <h1>Métricas Kanban</h1>
    </div>
    <div class="container-md shadow-sm p-3 mb-5 bg-body-tertiary rounded">
        <div class="mb-2 container parameters">
            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="textArea">Tickets a analizar</label>
                        <textarea class="form-control" id="textArea" name="textArea" rows="2"
                            placeholder="#85aaaaaa, #85bbbbbb, #85cccccc...">{{.Tickets}}</textarea>
                    </div>
                
                    <button id="openModalBtn" class="btn custom-btn-secondary mt-4">Configurar Token Clickup</button>
                </div>
                <div class="col-md-6">
                    <div class="mb-2 form-group row">
                        <label for="startDate" class="col-md-4 col-form-label">Desde</label>
                        <div class="col-md-8">
                            <input type="date" class="form-control" id="startDate" name="startDate"
                                value="{{.StartDate}}">
                        </div>
                    </div>
                    <div class="mb-2 form-group row">
                        <label for="endDate" class="col-md-4 col-form-label">Hasta</label>
                        <div class="col-md-8">
                            <input type="date" class="form-control" id="endDate" name="endDate" value="{{.EndDate}}">
                        </div>
                    </div>
                    <div class="mb-2 form-group row">
                        <label for="prefix" class="col-md-4 col-form-label">Prefijo</label>
                        <div class="col-md-8">
                            <input type="text" class="form-control" id="prefix" name="prefix" placeholder="CORE o PRGA"
                                value="{{.Prefix}}">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <hr>
        <div class="container">
            <button id="calculateBtn" class="btn custom-btn-primary" onclick="calculate()">
                <span id="calculateText">Generar reporte</span>
                <span id="spinner" class="spinner" style="display: none;"></span>
            </button>
        </div>
    </div>
    <!-- Modal -->
    <div id="myModal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close" id="closeModalBtn">&times;</span>
            <h2>Configurar Token Clickup</h2>
            <label for="tokenInput">Token</label>
            <br>
            <input type="text" id="tokenInput" name="tokenInput">
            <button id="saveTokenBtn">Guardar</button>
        </div>
    </div>

    <div class="container">

        <h4 class="pb-2">Resumen</h4>
        <hr>
        {{template "average_metrics" . }}
        <h4 class="pb-2">Tickets analizados</h4>
        <hr>
        {{if .IsClickupTokenExpired}}
        {{template "no_data" "Token de Clickup expirado o no configurado" }}
        {{else if eq (len .TaskMetrics) 0}}
        {{template "no_data" "No hay datos para los tickets ingresados" }}
        {{else}}
        {{template "tickets_table" . }}
        <div class="charts-block">
            <div class="container text-center">
                <div class="row gx-5 mb-4">
                    <div class="col-md-6 ">
                        {{template "line_chart" .LeadTimeData}}
                    </div>
                    <div class="col-md-6">
                        {{template "line_chart" .CycleTimeData}}
                    </div>
                </div>
                <div class="row gx-5">
                    <div class="col-md-6">
                        {{template "line_chart" .BlockedTimeData}}
                    </div>
                    <div class="col-md-6">
                        {{template "line_chart" .FlowEfficiencyData}}
                    </div>
                </div>
            </div>
        </div>
        {{end}}
        <h4 class="pb-2 mt-4">Merge Requets</h4>
        <hr>
        {{if eq (len .MergeRequests) 0}}
        {{template "no_data" "No hay MRs en el rango de fechas especificado" }}
        {{else}}
        {{template "merge_requests_table" . }}

        <div class="charts-block pb-4">
            <div class="container text-center">
                <div class="row gx-5 mb-4">
                    <div class="col-md-6 ">
                        {{template "bar_chart" .MergeRequestTimeToMerge}}
                    </div>
                    <div class="col-md-6 ">
                        {{template "bar_chart" .MergeRequestSize}}
                    </div>
                </div>
            </div>
        </div>

        {{end}}

        {{template "scripts"}}
    </div>

</body>

</html>