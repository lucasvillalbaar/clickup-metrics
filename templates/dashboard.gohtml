<!DOCTYPE html>
<html>

<head>
    <title>Métricas Kanban</title>
    <link rel="stylesheet" type="text/css" href="/static/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <h1>MÉTRICAS KANBAN</h1>

    <div class="date-selector-block">
        <label for="startDate">Desde</label>
        <input type="date" id="startDate" name="startDate" value="{{.StartDate}}">

        <label for="endDate">Hasta</label>
        <input type="date" id="endDate" name="endDate" value="{{.EndDate}}">

        <button onclick="calculate()">Calculate</button>
    </div>

    {{template "average_metrics"}}

    <div class="charts-block">
        {{template "line_chart" .LeadTimeData}}
    
        {{template "line_chart" .CycleTimeData}}

        {{template "line_chart" .BlockedTimeData}}

        {{template "line_chart" .FlowEfficiencyData}}

        {{template "bar_chart" .MergeRequestTimeToMerge}}

        {{template "bar_chart" .MergeRequestSize}}
    </div>

    <h2>TICKETS ANALIZADOS</h2>

    <table border="1">
        <tr>
            <th>ID</th>
            <th>Custom ID</th>
            <th>Nombre</th>
            <th>Fecha Inicio</th>
            <th>Fecha Fin</th>
            <th>Lead Time</th>
            <th>Cycle Time</th>
            <th>Blocked Time</th>
            <th>Flow Efficiency</th>
        </tr>
        {{range .DatosList}}
        <tr>
            <td class="centered">{{.ID}}</td>
            <td class="centered">{{.CustomID}}</td>
            <td>{{.Nombre}}</td>
            <td class="centered">{{.FechaInicio}}</td>
            <td class="centered">{{.FechaFin}}</td>
            <td class="centered">{{.LeadTime}}</td>
            <td class="centered">{{.CycleTime}}</td>
            <td class="centered">{{.BlockedTime}}</td>
            <td class="flow-efficiency">{{.FlowEfficiency}}</td>
        </tr>
        {{end}}
    </table>

    <script>
        function calculate() {
            // Get the selected dates
            let startDate = document.getElementById("startDate").value;
            let endDate = document.getElementById("endDate").value;
    
            // Construct the new URL with the selected dates as query parameters
            let newURL = '/dashboard?start_date=' + startDate + '&end_date=' + endDate;
    
            // Redirect the user to the new URL
            window.location.href = newURL;
        }
    </script
</body>

{{template "footer"}}

</html>